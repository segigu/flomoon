"use strict";(self.webpackChunkflomoon=self.webpackChunkflomoon||[]).push([[154],{1154:(e,r,s)=>{s.d(r,{removeSubscriptionFromSupabase:()=>n,saveSubscriptionToSupabase:()=>o,updateSubscriptionSettings:()=>i});var t=s(3217);async function o(e){try{const{data:{user:i}}=await t.ND.auth.getUser();if(!i)return{success:!1,error:"User not authenticated"};const{data:a}=await t.ND.from("push_subscriptions").select("id").eq("user_id",i.id).eq("endpoint",e.endpoint).single();if(a){var r,s;const{error:o}=await t.ND.from("push_subscriptions").update({p256dh:e.keys.p256dh,auth:e.keys.auth,enabled:null===(r=null===(s=e.settings)||void 0===s?void 0:s.enabled)||void 0===r||r,updated_at:(new Date).toISOString()}).eq("id",a.id);if(o)return console.error("Failed to update subscription:",o),{success:!1,error:o.message}}else{var o,n;const{error:r}=await t.ND.from("push_subscriptions").insert({user_id:i.id,endpoint:e.endpoint,p256dh:e.keys.p256dh,auth:e.keys.auth,enabled:null===(o=null===(n=e.settings)||void 0===n?void 0:n.enabled)||void 0===o||o});if(r)return console.error("Failed to insert subscription:",r),{success:!1,error:r.message}}return{success:!0}}catch(i){return console.error("Error saving subscription to Supabase:",i),{success:!1,error:i instanceof Error?i.message:"Unknown error"}}}async function n(e){try{const{data:{user:r}}=await t.ND.auth.getUser();if(!r)return{success:!1,error:"User not authenticated"};const{error:s}=await t.ND.from("push_subscriptions").delete().eq("user_id",r.id).eq("endpoint",e);return s?(console.error("Failed to delete subscription:",s),{success:!1,error:s.message}):{success:!0}}catch(r){return console.error("Error removing subscription from Supabase:",r),{success:!1,error:r instanceof Error?r.message:"Unknown error"}}}async function i(e,r){try{const{data:{user:s}}=await t.ND.auth.getUser();if(!s)return{success:!1,error:"User not authenticated"};const{error:o}=await t.ND.from("push_subscriptions").update({enabled:r,updated_at:(new Date).toISOString()}).eq("user_id",s.id).eq("endpoint",e);return o?(console.error("Failed to update subscription settings:",o),{success:!1,error:o.message}):{success:!0}}catch(s){return console.error("Error updating subscription settings:",s),{success:!1,error:s instanceof Error?s.message:"Unknown error"}}}}}]);
//# sourceMappingURL=154.b662b5e8.chunk.js.map