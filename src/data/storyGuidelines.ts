export const NO_MYSTIC_RULES = `КРИТИЧЕСКИ ВАЖНО — НЕТ МИСТИКИ:
- АБСОЛЮТНО ЗАПРЕЩЕНО: любая мистика, магия, символизм, метафоры, загадочные места
- НЕТ слов: "мистика", "тайна", "загадка", "символ", "знак", "судьба"
- ТОЛЬКО РЕАЛЬНАЯ ЖИЗНЬ: обычные будни, понятные ситуации, реальные проблемы
- ТОЛЬКО реальные места: офис, квартира, кафе, парк, дом родителей, магазин, спортзал
- ТОЛЬКО реальные люди: начальник, мама, подруга, партнёр, коллеги, соседи
- ТОЛЬКО понятные ситуации: работа, семья, отношения, дружба, быт
- Конкретные диалоги и действия, а не абстрактные описания
- Жанр: ВСЕГДА "реализм" или "психологическая драма", НЕ "мистика"`;

export const EUROPE_CONTEXT_RULES = `КРИТИЧЕСКИ ВАЖНО — ЕВРОПЕЙСКИЙ КОНТЕКСТ:
- Действие происходит где-то в Европе (не указывай конкретную страну)
- ЗАПРЕЩЕНО использовать:
  ❌ Российские города (Москва, Питер, Екатеринбург и т.д.)
  ❌ Российские улицы, районы, топонимы
  ❌ Рубли, российские бренды
  ❌ Типично российские реалии
- Используй нейтральные европейские реалии:
  ✅ Евро как валюта (или вообще не упоминай деньги конкретно)
  ✅ Универсальные названия: "центр города", "старый район", "набережная"
  ✅ Нейтральные имена мест: кафе, офис, парк (без конкретных названий)`;

export const CHARACTER_NAME_RULES = `КРИТИЧЕСКИ ВАЖНО — ИМЕНА ПЕРСОНАЖЕЙ:
- АБСОЛЮТНО ЗАПРЕЩЕНЫ мужские имена: Игорь, Константин, Стас
- Используй другие имена: Максим, Денис, Артём, Алекс, Марк, Дима, Андрей, Роман
- Для женщин: Лена, Катя, Маша, Аня, Соня, Вика, Оля, Ира (любые, кроме Настя)`;

export const STORY_CONTINUITY_RULES = `КРИТИЧЕСКИ ВАЖНО — ЕДИНСТВО ИСТОРИИ:
- Это ОДНА развивающаяся история, а не отдельные эпизоды
- Каждая новая сцена — прямое продолжение предыдущей
- Сохраняй ВСЕХ персонажей из прошлых сцен (имена, характеры, отношения)
- Место действия может меняться, но логично (например: разговор на кухне → потом в своей комнате в том же доме)
- События развиваются последовательно: если герой сказал А в сцене 1, в сцене 2 он помнит об этом
- Эмоциональное состояние накапливается: усталость, напряжение, облегчение`;

export const STORY_STRUCTURE_POINTS = [
  '1. Завязка — конкретная жизненная ситуация с понятной дилеммой',
  '2. Обострение — давление со стороны других людей и обстоятельств',
  '3. Выбор — героиня выбирает: привычный путь или попробовать по-другому',
  '4. Последствия — реакции людей, собственные чувства, цена решения',
  '5. Кульминация — столкновение с главным страхом этого конфликта',
  '6. Развязка — что изменилось, что поняла, следующий шаг',
];

export const STORY_SCENE_REQUIREMENTS = `Требования к сцене:
- один абзац из 3–5 предложений (55–85 слов);
- КОНКРЕТИКА: называй места, действия, слова людей;
- РЕАЛИЗМ: всё должно быть узнаваемо из обычной жизни;
- используй мотивы из chart_analysis, но показывай их через поведение, а не символы;
- завершай ощущением выбора.`;

export const CHOICE_REQUIREMENTS = `После сцены подготовь два контрастных варианта выбора (без клише «продолжить»):
- title — до 32 символов;
- description — одно предложение до 90 символов.`;

export const JSON_FORMAT_RULES = `КРИТИЧЕСКИ ВАЖНО ДЛЯ ФОРМАТА JSON:
1. Все текстовые значения должны быть в ОДНУ строку без реальных переносов строк.
2. НЕ используй символ переноса строки (\\n) внутри строковых значений.
3. Используй пробелы вместо любых переносов строк внутри текста.
4. Если текст длинный, просто продолжай его в одну строку с пробелами.
5. JSON должен быть компактным и валидным для JSON.parse().`;

export const REALISTIC_SCENARIOS_EXAMPLES = {
  good: [
    '✅ "Офис в пятницу вечером: начальник просит остаться на выходные ради проекта, но ты планировала поездку"',
    '✅ "Кухня родительской квартиры: мама говорит, что ты эгоистка, потому что не приедешь помогать с ремонтом"',
    '✅ "Кафе с подругой: она в третий раз жалуется на одно и то же, и ты понимаешь, что устала слушать"',
  ],
  bad: [
    '❌ "Пустая станция метро в час ночи с мигающим табло"',
    '❌ "Заброшенный дом детства с призраками прошлого"',
    '❌ "Крыша небоскрёба в ветреную ночь"',
  ],
};

export const CONTRACT_LIFE_SPHERES = [
  { id: 'work', label: 'РАБОТА', examples: ['"Могу ли я отказаться от сверхурочной?"', '"Стоит ли менять профессию?"'] },
  { id: 'love', label: 'ЛЮБОВЬ', examples: ['"Могу ли я быть уязвимой в отношениях?"', '"Пора ли расстаться?"'] },
  { id: 'family', label: 'СЕМЬЯ', examples: ['"Могу ли я отказать родителям?"', '"Как отделиться от семьи?"'] },
  { id: 'friendship', label: 'ДРУЖБА', examples: ['"Могу ли я отказать токсичной подруге?"', '"Пора ли прекратить дружбу?"'] },
  { id: 'self_growth', label: 'САМОРАЗВИТИЕ', examples: ['"Могу ли я выйти из зоны комфорта?"', '"Стоит ли начать что-то новое?"'] },
  { id: 'creativity', label: 'ТВОРЧЕСТВО', examples: ['"Могу ли я показать своё творчество?"', '"Имею ли право на самовыражение?"'] },
  { id: 'hobby', label: 'ХОББИ', examples: ['"Могу ли я тратить время на хобби?"', '"Не эгоизм ли делать что-то для себя?"'] },
  { id: 'health', label: 'ЗДОРОВЬЕ', examples: ['"Могу ли я отдыхать без вины?"', '"Стоит ли заботиться о себе?"'] },
  { id: 'finance', label: 'ФИНАНСЫ', examples: ['"Могу ли я тратить деньги на себя?"', '"Как контролировать расходы?"'] },
];

export const RECENT_CONTRACT_RULES = `КРИТИЧЕСКИ ВАЖНО - МАКСИМАЛЬНОЕ РАЗНООБРАЗИЕ:
ПОСМОТРИ на recent_contract_ids выше! Если там:
   - work/career/job → НЕ пиши про работу! Выбери отношения, семью или хобби
   - family/parent → НЕ пиши про семью! Выбери работу, дружбу или творчество
   - friend/friendship → НЕ пиши про друзей! Выбери любовь, саморазвитие или финансы
   - relationship/love → НЕ пиши про отношения! Выбери хобби, здоровье или работу
   - social → НЕ пиши про общество! Выбери что-то личное`;

export function buildMoonSummaryInstruction(limit = 300): string {
  return `moon_summary — Сообщение от Луны (СТРОГО не больше ${limit} символов!), которое ОБРАЩАЕТСЯ К НАСТЕ напрямую. Луна как бы "замечает", что Настя читает диалог планет, и переключается с обсуждения в 3-м лице на прямое обращение. Начни с обращения типа "Настя, ты же нас тут читаешь?" или "О, Настя, привет! Видишь, что мы тут обсуждаем?". Затем ПРОСТЫМ ЯЗЫКОМ (БЕЗ астрологических терминов типа "квадрат", "оппозиция", "трин"!) кратко объясни, что обсудили и почему. Объясни влияние планет через бытовые сравнения. Стиль: тёплый, разговорный, с лёгким юмором.`;
}

export const FINALE_HUMAN_INTERPRETATION_RULES = `human_interpretation — критический анализ на человеческом языке (4–6 предложений) с ОБЯЗАТЕЛЬНЫМ объяснением:

ТОН: Здоровый сарказм, честность и юмор! Говори как умная подруга, которая видит насквозь и не будет врать "для поддержки".

1. ПОЧЕМУ ты сделала именно такие выборы на ключевых этапах — объясни мотивацию через черты характера
2. Какие особенности личности проявились: осторожность, любопытство, контроль, интуиция, или полный хаос?
3. КРИТИЧЕСКИ оцени: были ли выборы, которые НЕ свойственны характеру? Где действовала вопреки своей природе?
4. Укажи внутренние противоречия с САРКАЗМОМ (например: "Обычно ты осторожна как сапёр, но здесь решила 'а что я теряю?' — и понеслась")
5. ЕСЛИ выбор не соответствует ни характеру, ни контексту истории, ни психологическому контракту — ПРЯМО СКАЖИ: "Погоди, а это вообще о чём? Мы говорили про страх отказа, а ты тут решила написать пост в фейсбук. Интересный поворот, конечно..." (с иронией)
6. ЕСЛИ выбор выглядит случайным или абсурдным — ОТМЕТЬ С ЮМОРОМ: "Окей, тут ты явно экспериментировала. Или просто проверяла, что будет, если нажать красную кнопку?"
7. ЕСЛИ выбор социально-желательный, а не честный — ВСКРОЙ: "Возможно, ты отвечала 'как правильно', а не 'как чувствуешь'. Боялась показать, что на самом деле хочешь промолчать и спрятаться?"
8. НЕ используй астрологические термины (без упоминания планет, домов, аспектов)
9. Будь честной — не натягивай объяснения. Если выбор не укладывается в логику — скажи прямо, с иронией

ПРИМЕРЫ СТИЛЯ:
❌ ПЛОХО (слишком мягко): "Твой выбор показывает внутренний конфликт между желанием и страхом..."
✅ ХОРОШО (с сарказмом): "Секунду, ты только что 5 сцен избегала конфликта, а тут вдруг решила 'пойду скандалить'? Либо ты наконец прорвалась, либо случайно тапнула не туда. Серьёзно, откуда такая смелость?"`;


export const FINALE_ASTRO_RULES = `astrological_interpretation — критический астрологический анализ (4–7 предложений) с ОБЯЗАТЕЛЬНЫМ объяснением:
1. Конкретные планеты, знаки и дома из chart_analysis (например: "Солнце в Близнецах в 5-м доме", "Луна в квадрате с Сатурном")
2. ПОЧЕМУ ты сделала именно такие выборы на каждом из 6 этапов — объясни мотивацию через положения планет и аспекты
3. КРИТИЧЕСКИ оцени: были ли выборы, которые ПРОТИВОРЕЧАТ натальной карте? Где карта предсказывала одно, а ты сделала другое?
4. Объясни противоречия через напряжённые аспекты (квадраты, оппозиции) — внутренняя борьба планет
5. ЕСЛИ выбор противоречит карте и не объясняется аспектами, рассмотри: возможно, это социально-желательный ответ, а не истинная реакция? Карта показывает настоящую природу, а выбор — то, что человек хочет показать.
6. Не натягивай интерпретацию — если выбор не объясняется картой, честно скажи об этом
7. Используй астрологические термины, НО объясняй их влияние человеческим языком в скобках`;

export function formatLifeSphereExamples(): string {
  return CONTRACT_LIFE_SPHERES.map(
    sphere => `   ${sphere.label}: ${sphere.examples.join(', ')}`,
  ).join('\n');
}

export function formatScenarioExamples(): string {
  return [
    'ПРИМЕРЫ ХОРОШИХ СЦЕНАРИЕВ:',
    ...REALISTIC_SCENARIOS_EXAMPLES.good,
    '',
    'ПРИМЕРЫ ПЛОХИХ СЦЕНАРИЕВ:',
    ...REALISTIC_SCENARIOS_EXAMPLES.bad,
  ].join('\n');
}
