# –§–∞–∑–∞ 2: AI-–∞–≥–µ–Ω—Ç—ã –∏ —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö

**–°—Ç–∞—Ç—É—Å:** ‚è≥ –û–∂–∏–¥–∞–µ—Ç
**–ó–∞–≤–∏—Å–∏—Ç –æ—Ç:** –§–∞–∑–∞ 1
**ETA:** 5-6 –¥–Ω–µ–π
**–ü—Ä–æ–≥—Ä–µ—Å—Å:** 0% (0/14 –∑–∞–¥–∞—á)

---

## üéØ –¶–µ–ª—å —Ñ–∞–∑—ã

–°–æ–∑–¥–∞—Ç—å 3-—É—Ä–æ–≤–Ω–µ–≤—É—é —Å–∏—Å—Ç–µ–º—É AI-–∞–≥–µ–Ω—Ç–æ–≤ –¥–ª—è —Å–±–æ—Ä–∞, –∞–Ω–∞–ª–∏–∑–∞ –∏ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –∑–∞—Ç—Ä–∞—Ç–∞–º–∏ –Ω–∞ —Ç–æ–∫–µ–Ω—ã (—ç–∫–æ–Ω–æ–º–∏—è 24x).

**–†–µ–∑—É–ª—å—Ç–∞—Ç —Ñ–∞–∑—ã:** –†–∞–±–æ—Ç–∞—é—â–∞—è –∞–≥–µ–Ω—Ç—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞, –∫–æ—Ç–æ—Ä–∞—è:
- –ö–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –≤—ã–±–æ—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (Tier 1)
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω—ã –ø–æ–≤–µ–¥–µ–Ω–∏—è (Tier 2)
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç (Tier 3)
- –°—Ç–æ–∏–º–æ—Å—Ç—å: ~$0.011 –∑–∞ –∏—Å—Ç–æ—Ä–∏—é (vs $0.27 –±–µ–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏)

---

## üìã –ó–∞–¥–∞—á–∏

### 2.1 –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∞–≥–µ–Ω—Ç–æ–≤

**–§–∞–π–ª:** `src/ai-agents/BaseAgent.ts` (—Å–æ–∑–¥–∞—Ç—å)
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –Ω–µ—Ç
**–í—Ä–µ–º—è:** 3-4 —á–∞—Å–∞
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –û–∂–∏–¥–∞–µ—Ç

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –≤—Å–µ—Ö AI-–∞–≥–µ–Ω—Ç–æ–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π prompt caching –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –≤—ã–±–æ—Ä–æ–º –º–æ–¥–µ–ª–∏.

**Acceptance criteria:**
- [ ] `AgentConfig` –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (model, systemPrompt, temperature, maxTokens, cacheable)
- [ ] `BaseAgent<TInput, TOutput>` –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–ª–∞—Å—Å
- [ ] –ú–µ—Ç–æ–¥—ã: `buildPrompt()`, `parseResponse()`, `execute()`
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ prompt caching –¥–ª—è Claude API
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ (Haiku/Sonnet) –ø–æ config
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ retry –ª–æ–≥–∏–∫–∞
- [ ] –¢–µ—Å—Ç—ã –¥–ª—è BaseAgent

**–°–≤—è–∑–∞–Ω–Ω—ã–µ ADR:** [ADR-002-ai-agent-tiers.md](../architecture/ADR-002-ai-agent-tiers.md), [ADR-003-prompt-caching.md](../architecture/ADR-003-prompt-caching.md)

---

### 2.2 Tier 1: TrapDetectorAgent

**–§–∞–π–ª:** `src/ai-agents/TrapDetectorAgent.ts` (—Å–æ–∑–¥–∞—Ç—å)
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** 2.1
**–í—Ä–µ–º—è:** 2 —á–∞—Å–∞
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –û–∂–∏–¥–∞–µ—Ç

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ê–≥–µ–Ω—Ç –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤—ã–±–æ—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –ª–æ–≤—É—à–µ–∫.

**Acceptance criteria:**
- [ ] –ù–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç `BaseAgent<TrapDetectorInput, TrapDetectorOutput>`
- [ ] –ú–æ–¥–µ–ª—å: Haiku 4.5
- [ ] –ü—Ä–æ–º–ø—Ç –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—é (avoidance, people-pleasing, perfectionism, guilt, –∏ —Ç.–¥.)
- [ ] Output: `{ category: string | null, confidence: number }`
- [ ] –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: 0.2 (–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å)
- [ ] Max tokens: 100
- [ ] –¢–µ—Å—Ç—ã —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –≤—ã–±–æ—Ä–æ–≤

---

### 2.3 Tier 1: BatchTrapDetectorAgent

**–§–∞–π–ª:** `src/ai-agents/BatchTrapDetectorAgent.ts` (—Å–æ–∑–¥–∞—Ç—å)
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** 2.2
**–í—Ä–µ–º—è:** 1-2 —á–∞—Å–∞
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –û–∂–∏–¥–∞–µ—Ç

**–û–ø–∏—Å–∞–Ω–∏–µ:**
Batch-–≤–µ—Ä—Å–∏—è TrapDetectorAgent –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≤—ã–±–æ—Ä–æ–≤ –∑–∞ –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å (—ç–∫–æ–Ω–æ–º–∏—è overhead).

**Acceptance criteria:**
- [ ] –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –º–∞—Å—Å–∏–≤ –≤—ã–±–æ—Ä–æ–≤ (–¥–æ 10 –∑–∞ —Ä–∞–∑)
- [ ] Output: –º–∞—Å—Å–∏–≤ `{ category, confidence }[]`
- [ ] –≠–∫–æ–Ω–æ–º–∏—è: ~2.6x —Ç–æ–∫–µ–Ω–æ–≤ vs –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- [ ] –¢–µ—Å—Ç—ã —Å 7 –≤—ã–±–æ—Ä–∞–º–∏ (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è)

---

### 2.4 Tier 1: ThemeExtractorAgent

**–§–∞–π–ª:** `src/ai-agents/ThemeExtractorAgent.ts` (—Å–æ–∑–¥–∞—Ç—å)
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** 2.1
**–í—Ä–µ–º—è:** 1-2 —á–∞—Å–∞
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –û–∂–∏–¥–∞–µ—Ç

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ê–≥–µ–Ω—Ç –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∫–ª—é—á–µ–≤—ã—Ö —Ç–µ–º –∏–∑ –∑–∞–º–µ—Ç–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ –¥–Ω—è—Ö —Ü–∏–∫–ª–∞.

**Acceptance criteria:**
- [ ] –ú–æ–¥–µ–ª—å: Haiku 4.5
- [ ] Input: —Ç–µ–∫—Å—Ç –∑–∞–º–µ—Ç–∫–∏
- [ ] Output: `{ themes: string[], mood: 'good'|'neutral'|'bad' }`
- [ ] –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: 0.3
- [ ] Max tokens: 150
- [ ] –¢–µ—Å—Ç—ã —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∑–∞–º–µ—Ç–æ–∫

---

### 2.5 Tier 2: PatternAnalyzerAgent

**–§–∞–π–ª:** `src/ai-agents/PatternAnalyzerAgent.ts` (—Å–æ–∑–¥–∞—Ç—å)
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** 2.1
**–í—Ä–µ–º—è:** 2-3 —á–∞—Å–∞
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –û–∂–∏–¥–∞–µ—Ç

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ê–≥–µ–Ω—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –ø–æ–≤–µ–¥–µ–Ω–∏—è –∏–∑ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤—ã–±–æ—Ä–æ–≤.

**Acceptance criteria:**
- [ ] –ú–æ–¥–µ–ª—å: Haiku 4.5
- [ ] Input: –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–Ω–µ —Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ!)
- [ ] Output: `{ dominantPattern, insight (1 sentence), triggers[] }`
- [ ] –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: 0.5
- [ ] Max tokens: 300
- [ ] –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é –∏–ª–∏ –∫–∞–∂–¥—ã–µ 5 –∏—Å—Ç–æ—Ä–∏–π
- [ ] –¢–µ—Å—Ç—ã —Å –º–æ–∫–æ–≤–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π

---

### 2.6 Tier 2: CorrelationAnalyzerAgent

**–§–∞–π–ª:** `src/ai-agents/CorrelationAnalyzerAgent.ts` (—Å–æ–∑–¥–∞—Ç—å)
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** 2.1
**–í—Ä–µ–º—è:** 2-3 —á–∞—Å–∞
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –û–∂–∏–¥–∞–µ—Ç

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ê–≥–µ–Ω—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–π –º–µ–∂–¥—É —Ü–∏–∫–ª–æ–º/–∞—Å—Ç—Ä–æ–ª–æ–≥–∏–µ–π –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ–º.

**Acceptance criteria:**
- [ ] –ú–æ–¥–µ–ª—å: Haiku 4.5
- [ ] Input: `{ cycleMoodStats, astroMoodStats }`
- [ ] Output: `{ cycleMoodInsight, astroMoodInsight, recommendations[] }`
- [ ] –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: 0.5
- [ ] Max tokens: 400
- [ ] –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é –¥–ª—è –æ—Ç—á—ë—Ç–∞
- [ ] –¢–µ—Å—Ç—ã —Å –º–æ–∫–æ–≤—ã–º–∏ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è–º–∏

---

### 2.7 Tier 3: ContractPersonalizerAgent

**–§–∞–π–ª:** `src/ai-agents/ContractPersonalizerAgent.ts` (—Å–æ–∑–¥–∞—Ç—å)
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** 2.1, 2.5
**–í—Ä–µ–º—è:** 3-4 —á–∞—Å–∞
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –û–∂–∏–¥–∞–µ—Ç

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ê–≥–µ–Ω—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ —Å —É—á—ë—Ç–æ–º –∏–Ω—Å–∞–π—Ç–æ–≤ –æ—Ç Tier 2.

**Acceptance criteria:**
- [ ] –ú–æ–¥–µ–ª—å: Sonnet 4.5
- [ ] Input: –≤—ã–∂–∏–º–∫–∞ –æ—Ç PatternAnalyzerAgent + astro vulnerabilities
- [ ] Output: –Ω–æ–≤—ã–π –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç
- [ ] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç prompt caching (–Ω–∞—Ç–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞, –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∞—Å—Ç—Ä–æ-—Ä–∞–Ω)
- [ ] –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: 0.7 (–∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å)
- [ ] Max tokens: 2000
- [ ] –¢–µ—Å—Ç—ã —Å —Ä–∞–∑–Ω—ã–º–∏ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è

**–°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã:** [AGENT_PROMPTS.md](../architecture/AGENT_PROMPTS.md)

---

### 2.8 Tier 3: InsightGeneratorAgent

**–§–∞–π–ª:** `src/ai-agents/InsightGeneratorAgent.ts` (—Å–æ–∑–¥–∞—Ç—å)
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** 2.1, 2.5, 2.6
**–í—Ä–µ–º—è:** 2-3 —á–∞—Å–∞
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –û–∂–∏–¥–∞–µ—Ç

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ê–≥–µ–Ω—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º—ã—Ö –∏–Ω—Å–∞–π—Ç–æ–≤ –¥–ª—è UI (–µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç).

**Acceptance criteria:**
- [ ] –ú–æ–¥–µ–ª—å: Sonnet 4.5
- [ ] Input: –≤—ã–∂–∏–º–∫–∏ –æ—Ç PatternAnalyzer + CorrelationAnalyzer
- [ ] Output: `{ summary, recommendations[], astroInsights[] }`
- [ ] –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: 0.6
- [ ] Max tokens: 1500
- [ ] –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é
- [ ] –¢–µ—Å—Ç—ã —Å –º–æ–∫–æ–≤—ã–º–∏ –∏–Ω—Å–∞–π—Ç–∞–º–∏

---

### 2.9 –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∞—Å—Ç—Ä–æ-–ø—Å–∏—Ö–æ–ª–æ–≥–∏–∏

**–§–∞–π–ª:** `src/data/astroPsychology.ts` (—Å–æ–∑–¥–∞—Ç—å)
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –Ω–µ—Ç
**–í—Ä–µ–º—è:** 4-5 —á–∞—Å–æ–≤
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –û–∂–∏–¥–∞–µ—Ç

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–°–æ–∑–¥–∞—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ—è–≤–ª–µ–Ω–∏–π –∞—Å—Ç—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –∞—Å–ø–µ–∫—Ç–æ–≤.

**Acceptance criteria:**
- [ ] –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å `AstroWoundProfile` (coreWound, manifestations, defenses, triggers, growthPath, therapyGoals, contractThemes)
- [ ] –û–ø–∏—Å–∞–Ω–æ 7-10 –æ—Å–Ω–æ–≤–Ω—ã—Ö –∞—Å–ø–µ–∫—Ç–æ–≤:
  - Moon-Saturn (–∫–≤–∞–¥—Ä–∞—Ç/–æ–ø–ø–æ–∑–∏—Ü–∏—è)
  - Venus-Pluto
  - Sun-Saturn
  - Mars-Saturn
  - Mercury-Neptune
  - –∏ –¥—Ä—É–≥–∏–µ
- [ ] –§—É–Ω–∫—Ü–∏—è `findAstroVulnerabilities(chartAnalysis)` - –ø–æ–∏—Å–∫ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö —Ä–∞–Ω
- [ ] –¢–µ—Å—Ç—ã —Å –Ω–∞—Ç–∞–ª—å–Ω–æ–π –∫–∞—Ä—Ç–æ–π –ù–∞—Å—Ç–∏

---

### 2.10 –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ü–∏–∫–ª–æ–≤

**–§–∞–π–ª:** `src/utils/cycleAnalyzer.ts` (—Å–æ–∑–¥–∞—Ç—å)
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –Ω–µ—Ç
**–í—Ä–µ–º—è:** 3 —á–∞—Å–∞
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –û–∂–∏–¥–∞–µ—Ç

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–π –º–µ–∂–¥—É —Ñ–∞–∑–∞–º–∏ —Ü–∏–∫–ª–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ–º.

**Acceptance criteria:**
- [ ] `analyzeCycleMoodCorrelations(cycles)` - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `CycleMoodCorrelation[]`
- [ ] –î–ª—è –∫–∞–∂–¥–æ–π —Ñ–∞–∑—ã: moodDistribution (%), averagePainLevel, commonNotes
- [ ] –§—É–Ω–∫—Ü–∏—è `determineCyclePhase(cycle, date)` - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ–∞–∑—ã –ø–æ –¥–∞—Ç–µ
- [ ] –§—É–Ω–∫—Ü–∏—è `extractCommonThemes(notes)` - —á–∞—Å—Ç—ã–µ —Ç–µ–º—ã –∏–∑ –∑–∞–º–µ—Ç–æ–∫
- [ ] –ú–∏–Ω–∏–º—É–º 3 —Ü–∏–∫–ª–∞ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- [ ] –¢–µ—Å—Ç—ã —Å –º–æ–∫–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

---

### 2.11 –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∞—Å—Ç—Ä–æ-–Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è

**–§–∞–π–ª:** `src/utils/astroMoodAnalyzer.ts` (—Å–æ–∑–¥–∞—Ç—å)
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –Ω–µ—Ç
**–í—Ä–µ–º—è:** 3 —á–∞—Å–∞
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –û–∂–∏–¥–∞–µ—Ç

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–π –º–µ–∂–¥—É –∞—Å—Ç—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–º–∏ —Ç—Ä–∞–Ω–∑–∏—Ç–∞–º–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ–º.

**Acceptance criteria:**
- [ ] `analyzeAstroMoodCorrelations(cycles, userProfile)` - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `AstroMoodCorrelation[]`
- [ ] –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç—Ä–∞–Ω–∑–∏—Ç–∞: moodImpact, occurrences, averageMood, examples
- [ ] –ü–∞—Ä—Å–∏–Ω–≥ —Ç–∏–ø–∞ —Ç—Ä–∞–Ω–∑–∏—Ç–∞ –∏–∑ –æ–ø–∏—Å–∞–Ω–∏—è ("—Ç—Ä–∞–Ω–∑–∏—Ç–Ω—ã–π –°–∞—Ç—É—Ä–Ω –∫–≤–∞–¥—Ä–∞—Ç –∫ –õ—É–Ω–µ" ‚Üí "Saturn-Moon square")
- [ ] –ú–∏–Ω–∏–º—É–º 3 —Å–ª—É—á–∞—è –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- [ ] –¢–µ—Å—Ç—ã —Å –º–æ–∫–æ–≤—ã–º–∏ —Ç—Ä–∞–Ω–∑–∏—Ç–∞–º–∏

---

### 2.12 –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ñ–∞–π–ª–µ—Ä

**–§–∞–π–ª:** `src/utils/psychologicalProfiler.ts` (—Å–æ–∑–¥–∞—Ç—å)
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** 2.2, 2.3, 2.5
**–í—Ä–µ–º—è:** 3-4 —á–∞—Å–∞
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –û–∂–∏–¥–∞–µ—Ç

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏.

**Acceptance criteria:**
- [ ] `detectTrapCategory(title, description)` - fallback –±–µ–∑ AI (—Ä–µ–≥—É–ª—è—Ä–∫–∏)
- [ ] `detectDominantPattern(choices)` - –ª–æ–∫–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞
- [ ] `updatePsychologicalProfile(storyAnalysis)` - –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
- [ ] `shouldRunFullAnalysis(profile)` - –ª–æ–≥–∏–∫–∞ –∑–∞–ø—É—Å–∫–∞ Tier 2 (—Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é / –∫–∞–∂–¥—ã–µ 5 –∏—Å—Ç–æ—Ä–∏–π)
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–Ω–µ –≤—Å—è –∏—Å—Ç–æ—Ä–∏—è)
- [ ] –¢–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π

---

### 2.13 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ DiscoverTabV2

**–§–∞–π–ª:** `src/components/DiscoverTabV2.tsx` (–∏–∑–º–µ–Ω–∏—Ç—å)
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** 2.3, 2.12
**–í—Ä–µ–º—è:** 3 —á–∞—Å–∞
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –û–∂–∏–¥–∞–µ—Ç

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—ã–±–æ—Ä–æ–≤ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∏—Å—Ç–æ—Ä–∏–∏.

**Acceptance criteria:**
- [ ] –ü—Ä–∏ –∫–∞–∂–¥–æ–º –≤—ã–±–æ—Ä–µ: —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ `currentStoryAnalysis.choices`
- [ ] –ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∏—Å—Ç–æ—Ä–∏–∏: –∑–∞–ø—É—Å—Ç–∏—Ç—å `BatchTrapDetectorAgent`
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å —á–µ—Ä–µ–∑ `updatePsychologicalProfile()`
- [ ] –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä "–∞–Ω–∞–ª–∏–∑ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è" –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –∞–≥–µ–Ω—Ç–∞
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∞–≥–µ–Ω—Ç–æ–≤ (fallback –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É)
- [ ] –¢–µ—Å—Ç—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

---

### 2.14 –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

**–í—Ä–µ–º—è:** 4-5 —á–∞—Å–æ–≤
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** 2.1-2.13
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –û–∂–∏–¥–∞–µ—Ç

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å—é –∞–≥–µ–Ω—Ç—Å–∫—É—é —Å–∏—Å—Ç–µ–º—É, –∏–∑–º–µ—Ä–∏—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å.

**Acceptance criteria:**
- [ ] –í—Å–µ unit —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (–ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª: –∏—Å—Ç–æ—Ä–∏—è ‚Üí –∞–Ω–∞–ª–∏–∑ ‚Üí –ø—Ä–æ—Ñ–∏–ª—å)
- [ ] –ò–∑–º–µ—Ä–µ–Ω–∞ —Å—Ç–æ–∏–º–æ—Å—Ç—å: ~$0.011 –∑–∞ –∏—Å—Ç–æ—Ä–∏—é (target)
- [ ] –ò–∑–º–µ—Ä–µ–Ω–æ –≤—Ä–µ–º—è: <5 —Å–µ–∫—É–Ω–¥ –¥–ª—è Tier 1, <10 —Å–µ–∫—É–Ω–¥ –¥–ª—è Tier 2
- [ ] Prompt caching —Ä–∞–±–æ—Ç–∞–µ—Ç (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ API metrics)
- [ ] –ù–µ—Ç —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞

---

## üîó –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É –∑–∞–¥–∞—á–∞–º–∏

```
2.1 (BaseAgent)
  ‚îú‚îÄ> 2.2 (TrapDetectorAgent)
  ‚îÇ    ‚îî‚îÄ> 2.3 (BatchTrapDetectorAgent)
  ‚îÇ         ‚îî‚îÄ> 2.12 (psychologicalProfiler)
  ‚îÇ              ‚îî‚îÄ> 2.13 (DiscoverTabV2 integration)
  ‚îú‚îÄ> 2.4 (ThemeExtractorAgent)
  ‚îú‚îÄ> 2.5 (PatternAnalyzerAgent)
  ‚îÇ    ‚îú‚îÄ> 2.7 (ContractPersonalizerAgent)
  ‚îÇ    ‚îî‚îÄ> 2.8 (InsightGeneratorAgent)
  ‚îî‚îÄ> 2.6 (CorrelationAnalyzerAgent)
       ‚îî‚îÄ> 2.8 (InsightGeneratorAgent)

2.9 (astroPsychology)
2.10 (cycleAnalyzer)
2.11 (astroMoodAnalyzer)

All --> 2.14 (testing)
```

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ñ–∞–∑—ã

- [ ] –í—Å–µ 14 –∑–∞–¥–∞—á –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç (`npm test`)
- [ ] –°—Ç–æ–∏–º–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ 1 –∏—Å—Ç–æ—Ä–∏–∏: ~$0.011 (¬±20%)
- [ ] –ê–≥–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ (error rate <1%)
- [ ] –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –∏—Å—Ç–æ—Ä–∏–∏
- [ ] `CHANGELOG.md` –æ–±–Ω–æ–≤–ª—ë–Ω
- [ ] `CURRENT_TASK.md` —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –§–∞–∑—É 3

---

## üí∞ –≠–∫–æ–Ω–æ–º–∏–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤ (target)

- Tier 1 (batch): ~1,050 —Ç–æ–∫–µ–Ω–æ–≤ ($0.0001)
- Tier 2 (—Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é): ~600 —Ç–æ–∫–µ–Ω–æ–≤ ($0.0006)
- Tier 3 (—Å caching): ~2,000 —Ç–æ–∫–µ–Ω–æ–≤ ($0.01)
- **–ò—Ç–æ–≥–æ –∑–∞ –∏—Å—Ç–æ—Ä–∏—é:** ~$0.011
- **–≠–∫–æ–Ω–æ–º–∏—è:** 24x vs –Ω–∞–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥ ($0.27)

---

## ‚û°Ô∏è –°–ª–µ–¥—É—é—â–∞—è —Ñ–∞–∑–∞

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫:
**[PHASE_3_PERSONALIZATION.md](./PHASE_3_PERSONALIZATION.md)** - –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è AI.

---

**–°–æ–∑–¥–∞–Ω–æ:** 2025-10-26
**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 2025-10-26
